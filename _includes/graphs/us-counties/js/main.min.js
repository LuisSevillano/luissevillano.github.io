function ready(t,e){function o(t,e){var o=t.properties.id;return-1===otherStates.indexOf(o)?o:void 0}function r(t){tooltipArrow.style("left",""),tooltipArrow.classed("top bottom",!1);var e=d3.event.layerX,o=d3.event.layerY,r=0,s=0;tooltipHeight=tooltip.node().getBoundingClientRect().height,tooltipWidth=tooltip.node().getBoundingClientRect().width,middleTooltipW=tooltipWidth/2,middleTooltipH=tooltipHeight/2,margins={left:middleTooltipW+10,right:width-middleTooltipW+2,top:tooltipHeight+middleTooltipH,bottom:height-middleTooltipH},isBetweenMarginsW=e>margins.left&&e<margins.right,isBetweenMarginsH=o>margins.top&&o<margins.bottom,o<margins.top?(s=o+50,tooltipArrow.classed("top",!0)):o>margins.top?(s=o-tooltipHeight-20,tooltipArrow.classed("bottom",!0)):(s=o-tooltipHeight-20,tooltipArrow.classed("bottom",!0)),e<margins.left?(r=10,tooltipArrow.style("left","").style("left",Math.max(e-20,-2)+"px")):isBetweenMarginsW?(r=e-middleTooltipW,tooltipArrow.style("left","").style("left",middleTooltipW-10+"px")):e>margins.right?(r=width-tooltipWidth+2,tooltipArrow.style("left","").style("right",Math.max(width-e-8,-2)+"px")):(r=e-middleTooltipW,tooltipArrow.style("left","").style("left",middleTooltipW-10+"px")),tooltip.style("left","").style("right","").style("left",r+"px").style("top",s+"px")}function s(t){var e=t.properties;d3.event.preventDefault(),d3.select(this).style("opacity",.85).style("stroke-width","1.5").style("stroke","black").attr("opacity",null).attr("stroke-width",null).attr("stroke",null).raise(),tooltip.style("display","block"),tooltip.selectAll("tbody tr").classed("c t j",!1),tooltip.select(".c1").classed(e.c1n,!0),tooltip.select(".c2").classed(e.c2n,!0),tooltip.select(".c3").classed(e.c3n,!0),tooltip.select(".county-name").html("Condado de "+e.n),tooltip.select(".state-name").html(stateNames[t.properties.cd].n+":"),tooltip.select(".electoral-votes").html(""+stateNames[t.properties.cd].v+" votos electorales"),tooltip.select(".c1 .cname").html(candidates[e.c1n]),tooltip.select(".c1 .cv").html(format(e.c1v)),tooltip.select(".c1 .cp").html(decFormat(e.c1p)+"%"),tooltip.select(".c2 .cname").html(candidates[e.c2n]),tooltip.select(".c2 .cv").html(format(e.c2v)),tooltip.select(".c2 .cp").html(decFormat(e.c2p)+"%"),tooltip.select(".c3 .cname").html(candidates[e.c3n]),tooltip.select(".c3 .cv").html(format(e.c3v)),tooltip.select(".c3 .cp").html(decFormat(e.c3p)+"%")}function l(t){tooltip.style("display","none");var e=scales[key]||function(){};return d3.select(this).style("opacity","1").style("stroke-width","0.5").style("stroke",function(t){return e(t.properties["c"+t.properties[key]+"p"])||scales[t.properties.c1n](t.properties.c1p)})}function a(){d3.selectAll(".filter").classed("active",!1),d3.select(this).classed("active",!0),key=d3.select(this).attr("data-candidate"),winner=key.length>1?"c1n":key;var t;t=scales[key]||function(){},n.selectAll(".county").style("fill",function(e,o){return t(e.properties["c"+e.properties[key]+"p"])||scales[e.properties.c1n](e.properties.c1p)}).style("stroke",function(e,o){return t(e.properties["c"+e.properties[key]+"p"])||scales[e.properties.c1n](e.properties.c1p)}),d3.select(".Alaska").style("fill",function(e){return t(e.properties["c"+e.properties[key]+"p"])||scales[e.properties.c1n](e.properties.c1p)})}function i(){desktop=window.innerWidth>768,containerWidth=mapContainer.node().getBoundingClientRect().width,width=Math.min(containerWidth,1600),desktop?c.on("mousemove",r).on("mouseenter",s).on("mouseleave",l):desktop&&c.on("mouseenter",null).on("mousemove",null).on("mouseenter",null).on("mouseleave",null),tooltip.style("display","none"),d3.selectAll("g.composition").attr("transform","scale("+containerWidth/860+")"),d3.select("#map-counties svg").style("height",.62*containerWidth),d3.select("#map-counties svg").style("width",containerWidth)}d3.selectAll(".filter").on("click",a);var n=mapContainer.append("svg").attr("width",width).attr("height",height).append("g").attr("class","composition"),p=n.append("defs");p.append("filter").attr("id","blur").append("feGaussianBlur").attr("stdDeviation",8),p.append("path").datum(topojson.feature(e,e.objects.states)).attr("id","land").attr("d",path),n.append("use").attr("class","land-glow").attr("xlink:href","#land").attr("transform","translate(-50,0)"),n.append("use").attr("class","land-fill").attr("xlink:href","#land").attr("transform","translate(-50,0)");n.append("g").attr("class","land").attr("transform","translate(-50,0)");countiesG=n.append("g").attr("class","counties").attr("transform","translate(-50,0)"),statesG=n.append("g").attr("class","states").attr("transform","translate(-50,0)"),labelsG=n.append("g").attr("class","labels").attr("transform","translate(-50,0)");var c=countiesG.selectAll(".county").data(topojson.feature(e,e.objects.counties).features).enter().append("path").attr("d",path).attr("class",function(t){return"county path county_cod_"+t.id+" "+t.properties.n}).attr("stroke-width","0.5").attr("fill",function(t){return scales[t.properties.c1n](t.properties.c1p)}).attr("stroke",function(t){return scales[t.properties.c1n](t.properties.c1p)});desktop&&c.on("mouseenter",s).on("mousemove",r).on("mouseenter",s).on("mouseleave",l);statesG.selectAll(".state").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("d",path).attr("class",function(t){return"state path state_cod_"+t.id+" "+t.properties.n}),labelsG.selectAll("map-label label").data(topojson.feature(e,e.objects.states).features).enter().append("text").attr("class",function(t){return"map-label label label_"+t.properties.id}).attr("transform",function(t){var e=path.centroid(t);return tranSettings[t.properties.id]&&(e[0]+=tranSettings[t.properties.id][0],e[1]+=tranSettings[t.properties.id][1]),"translate("+e+")"}).text(o);statesG.select(".Alaska").attr("data",function(t){t.properties.c1n="t",t.properties.c1v="130415",t.properties.c1p="52.9",t.properties.c2n="c",t.properties.c2v="93007",t.properties.c2p="37.7",t.properties.c3n="j",t.properties.c3v="14593",t.properties.c3p="5.9",t.properties.t=1,t.properties.c=2,t.properties.j=3}).style("fill",function(t){return repColorScale(t.properties.c1p)}).on("mouseenter",s).on("mousemove",r).on("mouseleave",l),d3.select(window).on("resize",i),i()}var width,height,statePath,mapContainer=d3.select("#map-counties"),candidates={c:"Hillary Clinton",t:"Donald Trump",j:"Gary Johnson"},filter={winner:"candidate1",dem:"j",rep:"t"};key="c1p",winner="c1n",active=d3.select(null),desktop=window.innerWidth>768,containerWidth=mapContainer.node().getBoundingClientRect().width,width=Math.min(containerWidth,1600),height=.62*width,tooltip=d3.select("#tooltip"),tooltipArrow=d3.select("#arrow"),format=d3.formatLocale({decimal:",",thousands:".",grouping:[3],currency:["",""]}).format("$,d"),decFormat=function(t){var e=t.replace(".",",");return e},demColorScale=d3.scaleLinear().domain([40,85]).range(["#5EA6D6","#1A80C4"]),repColorScale=d3.scaleLinear().domain([40,85]).range(["#DB7777","#CC3D3D"]),scales={c:function(t){return demColorScale(t)},t:function(t){return repColorScale(t)}};var projection=d3.geoAlbersUsa().scale(1100),path=d3.geoPath().projection(projection);d3.queue().defer(d3.json,"resources/us-counties/map/us.json").await(ready);
